# -*- coding: utf-8 -*-
"""verify_chembl_datasets.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1v1HBIdU7GOaGS8uKEktq9fgmC1jP4Vqb
"""

!pip install rdkit seaborn matplotlib

import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from rdkit import Chem
from rdkit.Chem import Draw
import os

parquet_files = [
    "all_graph.parquet",
    "all_meta.parquet",
    "human_graph.parquet",
    "human_meta.parquet",
    "human_egfr_graph.parquet",
    "human_egfr_meta.parquet",
    "all_egfr_graph.parquet",
    "all_egfr_meta.parquet"
]

for file_name in parquet_files:
    full_file_name = "/content/drive/MyDrive/datasets/" + file_name
    if not os.path.exists(full_file_name):
        print(f"\nâŒ PLIK NIE ISTNIEJE: {full_file_name} (pomijam)")
        continue

sns.set_theme(style="whitegrid")

for file_name in parquet_files:
    full_file_name = "/content/drive/MyDrive/datasets/" + file_name

    print(f"\n{'='*60}")
    print(f"ğŸ“‚ ANALIZA ZBIORU: {file_name}")
    print(f"{'='*60}")

    df = pd.read_parquet(full_file_name)

    print(f"Liczba wierszy: {len(df)}")
    print(f"Liczba kolumn: {len(df.columns)}")
    print("\nTypy danych:")
    print(df.dtypes)

    print("\nğŸ” BrakujÄ…ce wartoÅ›ci (Nulle):")
    null_counts = df.isnull().sum()
    if null_counts.sum() == 0:
        print("Brak pustych wartoÅ›ci! âœ…")
    else:
        print(null_counts[null_counts > 0])

    print("\nğŸ“Š Statystyki opisowe (Describe):")
    display(df.describe())

    print("\nğŸ‘€ PodglÄ…d pierwszych wierszy:")
    display(df.head(3))

    if 'graph_data' in df.columns:
        print("\nğŸ•¸ PrzykÅ‚adowe dane grafowe (pierwszy rekord):")
        sample_graph = df.iloc[0]['graph_data']
        print(sample_graph)

    print(f"\nğŸ§ª PrzykÅ‚adowe czÄ…steczki z {file_name}:")
    if 'input_smiles' in df.columns:
        smiles_list = df['input_smiles'].head(6).tolist()
        pIC50_list = df['target_pIC50'].head(6).tolist()

        mols = [Chem.MolFromSmiles(s) for s in smiles_list]

        valid_mols = [m for m in mols if m is not None]

        img = Draw.MolsToGridImage(
            valid_mols,
            molsPerRow=3,
            subImgSize=(300, 300),
            legends=[f"pIC50: {x:.2f}" for x in pIC50_list]
        )
        display(img)

    if 'target_pIC50' in df.columns:
        print(f"\nğŸ“ˆ RozkÅ‚ad target_pIC50:")
        plt.figure(figsize=(10, 5))

        sns.histplot(data=df, x='target_pIC50', kde=True, bins=30, color='teal')

        plt.title(f'RozkÅ‚ad wartoÅ›ci pIC50 - {file_name}')
        plt.xlabel('pIC50 (logarytmiczna siÅ‚a dziaÅ‚ania)')
        plt.ylabel('Liczba czÄ…steczek')
        plt.axvline(df['target_pIC50'].mean(), color='red', linestyle='--', label=f'Åšrednia: {df["target_pIC50"].mean():.2f}')
        plt.legend()
        plt.show()

    print("\n" + "-"*60 + "\n")